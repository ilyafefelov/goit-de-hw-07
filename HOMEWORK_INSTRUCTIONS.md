# Інструкції для здачі домашнього завдання Apache Airflow

## Кроки для виконання завдання

### 1. Підготовка середовища Airflow

1. **Встановіть Apache Airflow**:
   ```bash
   pip install apache-airflow
   pip install apache-airflow-providers-mysql
   ```

2. **Ініціалізуйте Airflow**:
   ```bash
   airflow db init
   airflow users create --username admin --firstname Admin --lastname User --email admin@admin.com --role Admin --password admin
   ```

### 2. Налаштування підключення до MySQL

1. Запустіть Airflow webserver та scheduler:
   ```bash
   airflow webserver --port 8080
   airflow scheduler
   ```

2. Відкрийте веб-інтерфейс Airflow: http://localhost:8080

3. Перейдіть до Admin → Connections

4. Створіть нове підключення з наступними параметрами:
   - **Connection Id**: `mysql_default`
   - **Connection Type**: `MySQL`
   - **Host**: `217.61.57.46`
   - **Database**: `neo_data`
   - **Login**: `neo_data_admin`
   - **Password**: [ваш пароль]
   - **Port**: `3306`

### 3. Завантаження DAG

1. Скопіюйте файл `olympic_medals_dag_v2.py` до папки dags вашого Airflow:
   ```bash
   cp olympic_medals_dag_v2.py $AIRFLOW_HOME/dags/
   ```

2. DAG автоматично з'явиться в веб-інтерфейсі через кілька хвилин

### 4. Тестування DAG

#### Сценарій 1: Успішне виконання (25 секунд затримки)

1. Відкрийте файл `olympic_medals_dag_v2.py`
2. Знайдіть функцію `create_delay` (рядок ~118)
3. Змініть `delay_seconds = 35` на `delay_seconds = 25`
4. Збережіть файл
5. У веб-інтерфейсі Airflow:
   - Увімкніть DAG `olympic_medals_processing_v2`
   - Натисніть "Trigger DAG"
   - Спостерігайте за виконанням

**Очікуваний результат**: Всі завдання виконуються успішно, включаючи сенсор

#### Сценарій 2: Невдача сенсора (35 секунд затримки)

1. Поверніть `delay_seconds = 35`
2. Збережіть файл
3. Знову запустіть DAG
4. Спостерігайте за виконанням

**Очікуваний результат**: Сенсор завершиться з помилкою тайм-ауту

### 5. Скриншоти для здачі

Зробіть скриншоти наступних елементів:

1. **Граф DAG** - покажіть структуру завдань та їх залежності
2. **Успішне виконання** - всі завдання зелені (25 сек затримка)
3. **Невдача сенсора** - сенсор червоний (35 сек затримка)
4. **Дані в таблиці** - показати записи в таблиці `IllyaF_medal_counts`

### 6. Перевірка даних в таблиці

Після виконання DAG перевірте дані:

```sql
SELECT id, medal_type, count, created_at 
FROM IllyaF_medal_counts 
ORDER BY created_at DESC 
LIMIT 10;
```

**Очікувані дані**:
- Bronze: 1004 записів
- Silver: 472 записів  
- Gold: 495 записів

### 7. Структура проекту для GitHub

```
goit-de-hw-07/
├── README.md                               # Опис проекту
├── olympic_medals_dag_v2.py               # Основний DAG
├── mysql_connector.py                     # Утиліти MySQL
├── test_connection.py                     # Тест підключення
├── requirements.txt                       # Залежності
├── screenshots/                           # Папка зі скриншотами
│   ├── dag_graph.png
│   ├── successful_run.png
│   ├── sensor_failure.png
│   └── table_data.png
└── homework_report.md                     # Звіт про виконання
```

### 8. Контрольний список

- [ ] DAG містить всі 6 завдань згідно з ТЗ
- [ ] Таблиця створюється з правильними полями
- [ ] Випадковий вибір медалі працює
- [ ] Розгалуження працює правильно
- [ ] Підрахунок медалей відбувається з правильної таблиці
- [ ] Затримка 25 сек - сенсор проходить
- [ ] Затримка 35 сек - сенсор падає
- [ ] Дані записуються в таблицю
- [ ] Зроблені скриншоти
- [ ] Код завантажений на GitHub

### 9. Можливі проблеми та рішення

**Проблема**: DAG не з'являється в інтерфейсі
- **Рішення**: Перевірте синтаксис Python, подивіться логи scheduler

**Проблема**: Помилка підключення до MySQL
- **Рішення**: Перевірте параметри підключення, firewall, доступність хоста

**Проблема**: Сенсор не працює
- **Рішення**: Перевірте SQL-запит сенсора, формат дати/часу

**Проблема**: Неправильні дані в таблиці
- **Рішення**: Перевірте назву таблиці-джерела, SQL-запити підрахунку

### 10. Додаткові можливості

- Використання змінних Airflow для конфігурації
- Додавання логування та моніторингу
- Створення алертів на основі результатів сенсора
- Розширення DAG додатковими завданнями
