# Инструкция по тестированию DAG на GoIT Airflow

## Доступы к серверу

- **URL**: https://airflow.goit.global/home
- **Пользователь**: airflow
- **Пароль**: airflow

## Шаги тестирования

### 1. Подготовка DAG файла

Ваш DAG файл готов для загрузки: `olympic_medals_dag_v2.py`

### 2. Загрузка DAG в Airflow

**Способ 1: Через веб-интерфейс (если поддерживается)**
1. Откройте https://airflow.goit.global/home
2. Войдите с учетными данными (airflow/airflow)
3. Найдите раздел для загрузки DAG файлов

**Способ 2: Через Git (рекомендуемый)**
1. Создайте GitHub репозиторий `goit-de-hw-07`
2. Загрузите туда ваш DAG файл
3. Возможно, администраторы GoIT настроили автоматическую синхронизацию

**Способ 3: Обратиться к администраторам**
- Отправьте DAG файл администраторам GoIT для ручной загрузки
- Укажите точное имя файла: `olympic_medals_dag_v2.py`

### 3. Проверка подключения к MySQL

В Airflow нужно настроить connection с параметрами:

```
Connection ID: mysql_default
Connection Type: MySQL  
Host: 217.61.57.46
Database: neo_data
Login: neo_data_admin
Password: Proyahaxuqithab9oplp
Port: 3306
```

### 4. Тестирование DAG

#### Сценарий 1: Успешное выполнение
1. В веб-интерфейсе найдите DAG `olympic_medals_processing_v2`
2. Включите DAG (toggle ON)
3. Нажмите "Trigger DAG" для ручного запуска
4. Наблюдайте выполнение в Graph View

#### Сценарий 2: Тестирование сенсора
1. Измените задержку в DAG:
   - 25 секунд для успешного прохождения сенсора
   - 35 секунд для провала сенсора
2. Перезагрузите DAG
3. Запустите тестирование

### 5. Мониторинг выполнения

**Важные разделы для просмотра:**
- **Graph View** - структура DAG и статус выполнения
- **Tree View** - история запусков
- **Task Instance Details** - детальные логи каждой задачи
- **Logs** - подробная информация о выполнении

### 6. Проверка результатов

После выполнения DAG проверьте данные в MySQL:

```sql
SELECT id, medal_type, count, created_at 
FROM IllyaF_medal_counts 
ORDER BY created_at DESC 
LIMIT 10;
```

**Ожидаемые результаты:**
- Bronze: 1004 записей
- Silver: 472 записей  
- Gold: 495 записей

### 7. Скриншоты для отчета

Сделайте скриншоты:
1. **Graph View** с успешным выполнением
2. **Graph View** с провалом сенсора
3. **Task Logs** ключевых задач
4. **MySQL результаты** запроса к таблице

## Возможные проблемы

### Проблема: DAG не появляется в интерфейсе
**Решение**: 
- Проверьте синтаксис Python
- Посмотрите логи scheduler в веб-интерфейсе
- Обратитесь к администраторам

### Проблема: Ошибка подключения к MySQL
**Решение**:
- Убедитесь, что connection настроен правильно
- Проверьте доступность хоста с сервера Airflow
- Протестируйте подключение через Test Connection

### Проблема: Задачи падают с ошибками
**Решение**:
- Изучите логи конкретных задач
- Проверьте SQL-запросы
- Убедитесь, что таблица `lina_aggregated_athlete_stats` существует

## Контакты для помощи

Если возникают проблемы:
1. Обратитесь к ментору курса
2. Напишите в канал поддержки GoIT
3. Проверьте документацию Airflow: https://airflow.apache.org/

## Альтернативное решение

Если загрузка на GoIT сервер невозможна, можете:
1. Установить локальный Airflow
2. Настроить подключение к удаленной MySQL
3. Протестировать DAG локально
4. Предоставить скриншоты локального тестирования
